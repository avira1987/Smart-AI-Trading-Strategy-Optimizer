# راهنمای تنظیم Kavenegar SMS

## مشکل
هنگام ارسال کد OTP، خطای زیر نمایش داده می‌شود:
```
خطا در ارسال پیامک: APIException[412] ارسال کننده نامعتبر است
```

## علت
شماره فرستنده (Sender) در Kavenegar تنظیم نشده یا نامعتبر است.

## راه حل

### مرحله 1: ورود به پنل Kavenegar

1. به [پنل کاربری Kavenegar](https://panel.kavenegar.com/) بروید
2. با حساب کاربری خود وارد شوید

### مرحله 2: دریافت شماره فرستنده

1. در پنل، به بخش **مدیریت** > **شماره‌های اختصاصی** بروید
2. شماره فرستنده (Sender) خود را پیدا کنید
3. اگر شماره ندارید، یک شماره اختصاصی خریداری کنید

### مرحله 3: تنظیم در فایل .env

1. در ریشه پروژه، فایل `.env` را باز کنید (یا از `env.example` کپی کنید)
2. این خط را اضافه یا ویرایش کنید:

```env
KAVENEGAR_API_KEY=YOUR_API_KEY_HERE
KAVENEGAR_SENDER=10008663
```

**نکات:**
- `KAVENEGAR_API_KEY`: کلید API شما از پنل Kavenegar
- `KAVENEGAR_SENDER`: شماره فرستنده شما (مثلاً `10008663`)

### مرحله 4: بررسی تنظیمات

شماره فرستنده باید:
- در پنل Kavenegar فعال باشد
- مجوز ارسال SMS داشته باشد
- فرمت صحیح داشته باشد (معمولاً 8 رقم)

### مرحله 5: راه‌اندازی مجدد

بعد از تغییر `.env`:
1. Backend را متوقف کنید (Ctrl+C)
2. دوباره راه‌اندازی کنید:

```powershell
.\START_ALL.ps1
```

## راه حل موقت (بدون شماره فرستنده)

اگر شماره فرستنده ندارید، می‌توانید `KAVENEGAR_SENDER` را خالی بگذارید یا حذف کنید:

```env
KAVENEGAR_API_KEY=YOUR_API_KEY_HERE
# KAVENEGAR_SENDER= (حذف یا کامنت کنید)
```

در این صورت، Kavenegar از شماره پیش‌فرض استفاده می‌کند، اما ممکن است در برخی موارد کار نکند.

## تست

1. به صفحه Login بروید
2. شماره موبایل خود را وارد کنید
3. روی "ارسال کد" کلیک کنید
4. باید پیامک دریافت کنید

## بررسی لاگ‌ها

اگر مشکل ادامه داشت، لاگ‌های backend را بررسی کنید:

```powershell
# در ترمینال Backend
# یا فایل backend/logs/api.log را باز کنید
```

## مشکلات رایج

### مشکل 1: شماره فرستنده نامعتبر
**راه حل**: مطمئن شوید شماره در پنل Kavenegar فعال است

### مشکل 2: API Key نامعتبر
**راه حل**: API Key را از پنل Kavenegar دوباره کپی کنید

### مشکل 3: اعتبار کافی ندارید
**راه حل**: در پنل Kavenegar، موجودی حساب خود را بررسی کنید

### مشکل 4: شماره موبایل نامعتبر
**راه حل**: مطمئن شوید شماره به فرمت `09123456789` (بدون +) وارد شده است

## تماس با پشتیبانی

اگر مشکل حل نشد:
1. به پنل Kavenegar بروید
2. بخش پشتیبانی را بررسی کنید
3. یا با پشتیبانی Kavenegar تماس بگیرید

