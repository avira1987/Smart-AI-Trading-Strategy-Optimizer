# راهنمای دسترسی از اینترنت

این راهنما نحوه تنظیم برنامه برای دسترسی از اینترنت را توضیح می‌دهد.

## پیش‌نیازها

1. **IP عمومی ثابت یا داینامیک**: باید IP عمومی سرور خود را بدانید
2. **دسترسی Administrator**: برای باز کردن پورت‌های فایروال
3. **دسترسی به روتر**: اگر از روتر استفاده می‌کنید، برای تنظیم Port Forwarding

## مراحل راه‌اندازی

### مرحله 1: دریافت IP عمومی

IP عمومی سرور خود را می‌توانید از یکی از روش‌های زیر دریافت کنید:

1. **از طریق وب سایت‌ها**:
   - https://www.whatismyip.com
   - https://api.ipify.org
   - https://icanhazip.com

2. **از طریق PowerShell**:
   ```powershell
   (Invoke-WebRequest -Uri "https://api.ipify.org" -UseBasicParsing).Content
   ```

### مرحله 2: تنظیم IP عمومی در برنامه

اسکریپت `setup_public_ip.ps1` را اجرا کنید:

```powershell
.\setup_public_ip.ps1
```

این اسکریپت:
- به صورت خودکار IP عمومی شما را تشخیص می‌دهد
- از شما می‌خواهد که IP را تأیید یا تغییر دهید
- پورت‌های Backend و Frontend را تنظیم می‌کند
- فایل `.env` و `frontend\.env` را به‌روزرسانی می‌کند

### مرحله 3: باز کردن پورت‌های فایروال

برای باز کردن پورت‌ها در فایروال Windows:

#### روش 1: استفاده از اسکریپت (پیشنهادی)

```powershell
# اجرا به عنوان Administrator
.\open_firewall_ports.ps1
```

#### روش 2: دستی از طریق PowerShell

```powershell
# باز کردن پورت Backend (8000)
netsh advfirewall firewall add rule name="Backend Port 8000" dir=in action=allow protocol=TCP localport=8000

# باز کردن پورت Frontend (3000)
netsh advfirewall firewall add rule name="Frontend Port 3000" dir=in action=allow protocol=TCP localport=3000
```

#### روش 3: از طریق Windows Firewall GUI

1. Windows Defender Firewall را باز کنید
2. Advanced settings را انتخاب کنید
3. Inbound Rules -> New Rule
4. Port -> TCP -> Specific local ports: `8000,3000`
5. Allow the connection
6. همه Profile‌ها را انتخاب کنید
7. نام مناسب بدهید (مثلاً "AI Trading App")

### مرحله 4: تنظیم Port Forwarding (اگر از روتر استفاده می‌کنید)

اگر سرور شما پشت یک روتر است، باید Port Forwarding را تنظیم کنید:

1. به تنظیمات روتر خود وارد شوید (معمولاً `192.168.1.1` یا `192.168.0.1`)
2. بخش Port Forwarding یا Virtual Server را پیدا کنید
3. قوانین زیر را اضافه کنید:
   - **Backend**: External Port `8000` -> Internal IP سرور -> Internal Port `8000`
   - **Frontend**: External Port `3000` -> Internal IP سرور -> Internal Port `3000`

### مرحله 5: راه‌اندازی برنامه

برنامه را راه‌اندازی کنید:

```powershell
.\START_ALL.ps1
```

## تست دسترسی

### تست از شبکه محلی

```powershell
# تست Backend
Invoke-WebRequest -Uri "http://localhost:8000/api/test/backend-status/" -UseBasicParsing

# تست Frontend
Start-Process "http://localhost:3000"
```

### تست از اینترنت

از دستگاه دیگری که به اینترنت متصل است:

```bash
# تست Backend
curl http://YOUR_PUBLIC_IP:8000/api/test/backend-status/

# تست Frontend
# مرورگر: http://YOUR_PUBLIC_IP:3000
```

## تنظیمات پیشرفته

### تغییر پورت‌ها

اگر می‌خواهید پورت‌های دیگری استفاده کنید:

1. فایل `.env` را ویرایش کنید:
   ```
   PUBLIC_PORT=8080
   FRONTEND_PUBLIC_PORT=8081
   ```

2. اسکریپت `setup_public_ip.ps1` را دوباره اجرا کنید

3. پورت‌های جدید را در فایروال باز کنید

### استفاده از دامنه (Domain)

اگر دامنه دارید:

1. DNS A Record را به IP عمومی سرور خود تنظیم کنید
2. در فایل `.env` به جای IP از دامنه استفاده کنید:
   ```
   PUBLIC_IP=yourdomain.com
   ```

3. تنظیمات CORS و CSRF را به‌روزرسانی کنید

### استفاده از HTTPS

برای امنیت بیشتر، استفاده از HTTPS توصیه می‌شود:

1. یک گواهینامه SSL دریافت کنید (Let's Encrypt رایگان است)
2. از یک Reverse Proxy مانند Nginx استفاده کنید
3. تنظیمات را برای HTTPS به‌روزرسانی کنید

## عیب‌یابی

### مشکل: نمی‌توانم از اینترنت به برنامه دسترسی پیدا کنم

**بررسی‌ها:**

1. **فایروال**: مطمئن شوید که پورت‌ها در فایروال باز هستند
   ```powershell
   Get-NetFirewallRule -DisplayName "*Port 8000*"
   Get-NetFirewallRule -DisplayName "*Port 3000*"
   ```

2. **روتر**: اگر از روتر استفاده می‌کنید، Port Forwarding را بررسی کنید

3. **IP عمومی**: مطمئن شوید که IP عمومی درست است
   ```powershell
   (Invoke-WebRequest -Uri "https://api.ipify.org" -UseBasicParsing).Content
   ```

4. **سرویس ISP**: برخی ISP‌ها پورت‌های خاصی را مسدود می‌کنند

### مشکل: فقط از localhost می‌توانم دسترسی پیدا کنم

**راه‌حل:**

1. مطمئن شوید که برنامه روی `0.0.0.0` اجرا می‌شود (نه `127.0.0.1`)
2. بررسی کنید که `PUBLIC_IP` در فایل `.env` تنظیم شده است
3. مطمئن شوید که `ALLOWED_HOSTS` شامل IP عمومی است

### مشکل: خطای CORS

**راه‌حل:**

1. مطمئن شوید که `PUBLIC_IP` در فایل `.env` تنظیم شده است
2. تنظیمات CORS در `backend/config/settings.py` را بررسی کنید
3. اگر از دامنه استفاده می‌کنید، دامنه را به `CORS_ALLOWED_ORIGINS` اضافه کنید

## امنیت

⚠️ **هشدارهای امنیتی:**

1. **فایروال**: فقط پورت‌های لازم را باز کنید
2. **رمز عبور**: رمز عبور قوی برای کاربر admin تنظیم کنید
3. **HTTPS**: در صورت امکان از HTTPS استفاده کنید
4. **به‌روزرسانی**: برنامه و سیستم عامل را به‌روز نگه دارید
5. **لاگ‌ها**: لاگ‌های امنیتی را بررسی کنید

## پشتیبانی

برای مشکلات بیشتر:
1. فایل‌های لاگ را بررسی کنید: `backend/logs/`
2. تنظیمات را در فایل `.env` بررسی کنید
3. مستندات Django و React را مطالعه کنید

## خلاصه دستورات

```powershell
# تنظیم IP عمومی
.\setup_public_ip.ps1

# باز کردن پورت‌های فایروال
.\open_firewall_ports.ps1

# راه‌اندازی برنامه
.\START_ALL.ps1

# تست دسترسی
Invoke-WebRequest -Uri "http://YOUR_PUBLIC_IP:8000/api/test/backend-status/" -UseBasicParsing
```



